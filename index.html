<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>象数疗法检索</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body{font-family:-apple-system,BlinkMacSystemFont,'PingFang SC',sans-serif;margin:0;background:#f4f6f9;color:#333}
    .container{max-width:900px;margin:0 auto;padding:16px}
    .header{background:#fff;border-radius:14px;padding:18px;text-align:center;font-size:22px;font-weight:600;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
    .search-box{display:flex;gap:10px;margin-bottom:15px}
    input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid #ddd;font-size:16px;outline:none}
    input:focus{border-color:#1bb36b}
    .tabs{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:15px}
    .tab{background:#fff;border-radius:20px;padding:8px 16px;font-size:14px;cursor:pointer;border:1px solid #eee}
    .tab.active{background:#1bb36b;color:#fff;border-color:#1bb36b}
    .card{background:#fff;border-radius:12px;padding:15px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,0.04)}
    .card-title{font-weight:bold;font-size:17px;color:#1bb36b;margin-bottom:8px}
    .card-formula{font-size:20px;letter-spacing:2px;color:#e74c3c;margin:10px 0;font-family:monospace}
    .card-content{font-size:14px;color:#666;line-height:1.5}
    .count{text-align:center;color:#888;font-size:13px;margin-bottom:10px}
</style>
</head>
<body>

<div class="container">
    <div class="header">象数疗法检索</div>
    
    <div class="search-box">
        <input type="text" id="search" placeholder="输入关键字、症状或配方..." oninput="render()">
    </div>

    <div id="tabs" class="tabs">
        </div>

    <div id="count" class="count"></div>
    <div id="list"></div>
</div>

<script>
// 这里将 data_fixed.json 的内容直接粘贴进来
// 注意：以下只是示例数据，请将你 json 文件中的所有内容替换到这个数组里
let data = [
  {
    "category": "救急小配方",
    "title": "上楼上山不觉累",
    "formula": "720·650",
    "content": ""
  },
  {
    "category": "神经类配方",
    "title": "失眠",
    "formula": "80·20",
    "content": "心脾两虚型"
  }
  // ... 粘贴剩余所有数据
];

let currentCategory = "全部";

// 自动从数据中提取所有分类，确保不会出现找不到分类的情况
function initTabs() {
    const categories = ["全部", ...new Set(data.map(item => item.category))];
    const box = document.getElementById("tabs");
    box.innerHTML = ""; // 清空旧标签
    
    categories.forEach(c => {
        const div = document.createElement("div");
        div.className = "tab" + (c === currentCategory ? " active" : "");
        div.innerText = c;
        div.onclick = () => {
            currentCategory = c;
            document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
            div.classList.add("active");
            render();
        };
        box.appendChild(div);
    });
}

function render() {
    const key = document.getElementById("search").value.toLowerCase();
    const listBox = document.getElementById("list");
    const countBox = document.getElementById("count");
    
    // 过滤数据
    const filtered = data.filter(d => {
        const matchCat = (currentCategory === "全部" || d.category === currentCategory);
        const matchKey = (
            d.title.toLowerCase().includes(key) || 
            d.formula.toLowerCase().includes(key) || 
            (d.content && d.content.toLowerCase().includes(key))
        );
        return matchCat && matchKey;
    });

    countBox.innerText = `找到 ${filtered.length} 条相关配方`;
    
    // 渲染列表
    listBox.innerHTML = filtered.map(d => `
        <div class="card">
            <div class="card-title">${d.title}</div>
            <div class="card-formula">${d.formula}</div>
            <div class="card-content">${d.content || ""}</div>
            <div style="font-size:10px; color:#ccc; margin-top:5px;">分类：${d.category}</div>
        </div>
    `).join('');
}

// 页面加载后立即执行
if (data.length > 0) {
    initTabs();
    render();
} else {
    document.getElementById("list").innerHTML = "<p style='text-align:center;color:red;'>数据加载失败，请检查脚本中的 data 数组。</p>";
}
</script>

</body>
</html>
