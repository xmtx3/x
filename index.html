<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八卦象数疗法检索</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft YaHei", sans-serif; }
        body { background-color: #f0f2f5; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; padding: 15px; }

        /* 头部样式 */
        .header { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); text-align: center; margin-bottom: 20px; }
        .search-bar { margin: 15px auto; max-width: 600px; position: relative; }
        #search-input { width: 100%; padding: 14px 25px; border: 2px solid #007bff; border-radius: 50px; outline: none; font-size: 16px; }
        
        .main-content { display: flex; gap: 20px; }

        /* 电脑端导航 */
        .sidebar { width: 260px; background: #fff; border-radius: 12px; padding: 15px; height: 80vh; position: sticky; top: 20px; overflow-y: auto; }
        .category-item { padding: 12px 15px; border-radius: 8px; cursor: pointer; list-style: none; margin-bottom: 5px; transition: 0.2s; border-left: 4px solid transparent; }
        .category-item:hover, .category-item.active { background: #e6f7ff; color: #007bff; border-left-color: #007bff; font-weight: bold; }

        /* 内容区 */
        .content-area { flex: 1; }
        .card-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .card { background: #fff; border-radius: 10px; padding: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border-top: 3px solid #007bff; }
        .formula { color: #d93025; font-size: 1.2em; font-weight: bold; display: block; margin: 10px 0; letter-spacing: 1px; }
        .note { font-size: 12px; color: #888; background: #f8f9fa; padding: 6px; border-radius: 4px; margin-top: 10px; }

        /* --- 手机端专项调整 --- */
        @media (max-width: 768px) {
            .main-content { flex-direction: column; }
            
            /* 手机端第一屏导航变成九宫格/网格风格 */
            .sidebar { 
                width: 100%; 
                height: auto; 
                position: relative; 
                top: 0; 
                display: grid; 
                grid-template-columns: repeat(3, 1fr); /* 每行三个 */
                gap: 10px;
                background: none;
                box-shadow: none;
                padding: 10px 0;
            }
            .category-item { 
                background: #fff; 
                text-align: center; 
                padding: 15px 5px; 
                font-size: 13px; 
                border: 1px solid #eee;
                border-left: none;
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 60px;
            }
            .category-item.active { background: #007bff; color: #fff; }
            
            .header h1 { font-size: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>八卦象数疗法检索大全</h1>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="输入病症名或配方数字搜索...">
            </div>
            <div id="result-count" style="font-size: 14px; color: #666;">正在加载全书配方...</div>
        </div>

        <div class="main-content">
            <ul class="sidebar" id="category-list"></ul>
            
            <div class="content-area">
                <div class="card-container" id="card-container"></div>
            </div>
        </div>
    </div>

    <script>
        let therapyData = [];

        // 加载数据
        async function loadData() {
            try {
                const res = await fetch('data.json');
                therapyData = await res.json();
                initPage();
            } catch (e) {
                document.getElementById('result-count').innerHTML = "数据加载失败，请刷新重试";
            }
        }

        function initPage() {
            generateSidebar();
            renderCards(therapyData); 
            updateCount(therapyData.length);
        }

        // 渲染函数
        function renderCards(data) {
            const container = document.getElementById('card-container');
            // 修正搜索无反应问题：确保这里有数据
            if (data.length === 0) {
                container.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px; color:#999;">没有找到相关配方</div>';
                return;
            }
            container.innerHTML = data.slice(0, 300).map(item => `
                <div class="card">
                    <div style="color:#007bff; font-size:12px; margin-bottom:5px;">[${item.category}]</div>
                    <div style="font-weight:bold; font-size:16px;">${item.title}</div>
                    <span class="formula">${item.formula}</span>
                    <div style="font-size:14px; color:#555;">${item.content}</div>
                    <div class="note">⚠️ 试念无不适后持念。</div>
                </div>
            `).join('');
        }

        // 生成分类
        function generateSidebar() {
            const list = document.getElementById('category-list');
            const cats = ["全部", ...new Set(therapyData.map(i => i.category))];
            list.innerHTML = cats.map(c => `
                <li class="category-item ${c==='全部'?'active':''}" onclick="filterCat('${c}', this)">${c}</li>
            `).join('');
        }

        // 分类过滤
        function filterCat(name, el) {
            document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            const filtered = name === '全部' ? therapyData : therapyData.filter(i => i.category === name);
            renderCards(filtered);
            updateCount(filtered.length);
            // 手机端点击后滚动到内容区
            if (window.innerWidth < 768) {
                window.scrollTo({ top: document.querySelector('.content-area').offsetTop - 20, behavior: 'smooth' });
            }
        }

        // 搜索逻辑修复：增加多种匹配模式
        document.getElementById('search-input').addEventListener('input', function(e) {
            const val = e.target.value.trim().toLowerCase();
            const filtered = therapyData.filter(i => 
                i.title.toLowerCase().includes(val) || 
                i.formula.includes(val) ||
                i.category.toLowerCase().includes(val)
            );
            renderCards(filtered);
            updateCount(filtered.length);
        });

        function updateCount(n) {
            document.getElementById('result-count').innerText = "当前显示：" + n + " 条配方";
        }

        loadData();
    </script>
</body>
</html>
